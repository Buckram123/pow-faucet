(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{130:function(t,e,a){t.exports=a(273)},150:function(t,e){},152:function(t,e){},172:function(t,e){},177:function(t,e){},225:function(t,e){},226:function(t,e){},273:function(t,e,a){"use strict";a.r(e);var n=a(2),c=a.n(n),r=a(122),o=a.n(r),s=a(43),i=a(123),u=a(4),l=a.n(u),f=a(33),h=a(124),d=a(125),m=a(128),p=a(126),g=a(129),w=a(20),k=a(127),v=/^(([a-z\d]+[-_])*[a-z\d]+\.)*([a-z\d]+[-_])*[a-z\d]+$/,_=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(m.a)(this,Object(p.a)(e).call(this,t))).state={connected:!1,signedIn:!1,accountId:null,newAccountId:"",creating:!1,accountLoading:!1,newAccountExists:!1,computingProofOfWork:!1},a.initNear().then((function(){a.setState({connected:!0,signedIn:!!a._authData.accountId,accountId:a._authData.accountId})})),a}return Object(g.a)(e,t),Object(d.a)(e,[{key:"initFaucet",value:function(){var t=Object(f.a)(l.a.mark((function t(){var e,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._keyStore.getKey(this._nearConfig.networkId,"meta");case 2:if(t.sent){t.next=7;break}return e=w.KeyPair.fromString("ed25519:2Rtn6ms22rCRMgmGgLRSPPd6gYDCgWDuFrX6gERknSA8GKiCHE5L9Rksc1ihsSCDvMSptfbipzq29H7cDZhR1Ze3"),t.next=7,this._keyStore.setKey(this._nearConfig.networkId,"meta",e);case 7:return a=new w.Account(this._near.connection,"meta"),this._faucetContract=new w.Contract(a,"meta",{viewMethods:["get_min_difficulty","get_account_suffix","get_num_created_accounts"],changeMethods:["create_account"],sender:"meta"}),t.next=11,this._faucetContract.get_account_suffix();case 11:return this._accountSuffix=t.sent,t.next=14,this._faucetContract.get_min_difficulty();case 14:return this._minDifficulty=t.sent,t.t0=this,t.next=18,this._faucetContract.get_num_created_accounts();case 18:t.t1=t.sent,t.t2={numCreatedAccounts:t.t1},t.t0.setState.call(t.t0,t.t2);case 21:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initNear",value:function(){var t=Object(f.a)(l.a.mark((function t(){var e,a,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={networkId:"default",nodeUrl:"https://rpc.nearprotocol.com",contractName:"meta",walletUrl:"https://wallet.nearprotocol.com"},a=new w.keyStores.BrowserLocalStorageKeyStore,t.next=4,w.connect(Object.assign({deps:{keyStore:a}},e));case 4:return n=t.sent,this._keyStore=a,this._nearConfig=e,this._near=n,this._authData=JSON.parse(window.localStorage.getItem("meta-faucet-auth-data")||"{}"),t.next=11,this.initFaucet();case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleChange",value:function(t,e){var a=this,n=Object(i.a)({},t,e);"newAccountId"===t&&(e=e.toLowerCase().replace(/[^a-z0-9\-_.]/,""),n[t]=e,n.newAccountExists=!1,this.isValidAccount(e)&&(n.accountLoading=!0,this._near.connection.provider.query("account/".concat(e+this._accountSuffix),"").then((function(t){a.state.newAccountId===e&&a.setState({accountLoading:!1,newAccountExists:!0})})).catch((function(t){a.state.newAccountId===e&&a.setState({accountLoading:!1,newAccountExists:!1})})))),this.setState(n)}},{key:"isValidAccount",value:function(t){if(t.includes("."))return!1;var e=t+this._accountSuffix;return e.length>=2&&e.length<=64&&e.match(v)}},{key:"newAccountClass",value:function(){return!this.state.newAccountId||this.state.accountLoading?"form-control form-control-large":!this.state.newAccountExists&&this.isValidAccount(this.state.newAccountId)?"form-control form-control-large is-valid":"form-control form-control-large is-invalid"}},{key:"computeProofOfWork",value:function(){var t=Object(f.a)(l.a.mark((function t(e,a){var n,c,r,o,i,u,f,h,d,m;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(c=Object(s.a)(new TextEncoder("utf-8").encode(e+":"))).push(0),(n=c).push.apply(n,Object(s.a)(a.data)),c.push(":".charCodeAt(0)),c.push(0,0,0,0,0,0,0,0),c=new Uint8Array(c),r=c.length,o=0,i=0;case 9:return t.t0=Uint8Array,t.next=12,crypto.subtle.digest("SHA-256",c);case 12:t.t1=t.sent,u=new t.t0(t.t1),f=0,h=0;case 16:if(!(h<u.length)){t.next=24;break}if(d=Math.clz32(u[h])-24,f+=d,!(d<8)){t.next=21;break}return t.abrupt("break",24);case 21:++h,t.next=16;break;case 24:if(!(f>=this._minDifficulty)){t.next=29;break}return this.setState({computingProofOfWork:!1}),t.abrupt("return",i);case 29:f>o?(o=f,this.setState({proofOfWorkProgress:Math.trunc(100*o/this._minDifficulty),proofOfWorkDifficulty:o,proofOfWorkSalt:i})):i%1e4===0&&this.setState({proofOfWorkSalt:i});case 30:m=r-8;case 31:if(!(m<r)){t.next=41;break}if(255!==c[m]){t.next=36;break}c[m]=0,t.next=38;break;case 36:return++c[m],t.abrupt("break",41);case 38:++m,t.next=31;break;case 41:++i,t.next=9;break;case 44:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}()},{key:"createAccount",value:function(){var t=Object(f.a)(l.a.mark((function t(){var e,a,n,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({creating:!0,computingProofOfWork:!0,proofOfWorkProgress:0,proofOfWorkDifficulty:0,proofOfWorkSalt:0}),e=this.state.newAccountId+this._accountSuffix,a=Object(k.generateSeedPhrase)(),n=w.KeyPair.fromString(a.secretKey),t.next=6,this.computeProofOfWork(e,n.getPublicKey());case 6:return c=t.sent,t.next=9,this._faucetContract.create_account({account_id:e,public_key:[0].concat(Object(s.a)(n.getPublicKey().data)),salt:c});case 9:return t.next=11,this._keyStore.setKey(this._nearConfig.networkId,e,n);case 11:this._authData={accountId:e,seed:a},window.localStorage.setItem("meta-faucet-auth-data",JSON.stringify(this._authData)),this.setState({signedIn:!0,accountId:e,creating:!1});case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"moveAccountToWallet",value:function(){window.location="https://wallet.nearprotocol.com/recover-with-link/".concat(this._authData.accountId,"/").concat(this._authData.seed.seedPhrase)}},{key:"logout",value:function(){window.localStorage.removeItem("meta-faucet-auth-data"),this._authData={},this.setState({signedIn:!1,accountId:null,newAccountId:"",creating:!1,accountLoading:!1,newAccountExists:!1,computingProofOfWork:!1})}},{key:"render",value:function(){var t=this,e=this.state.connected?this.state.signedIn?c.a.createElement("div",null,c.a.createElement("h3",null,"Hello, ",this.state.accountId),c.a.createElement("div",{className:"form-group"},c.a.createElement("button",{className:"btn btn-success",onClick:function(){return t.moveAccountToWallet()}},"Move account to NEAR Wallet")),c.a.createElement("div",{className:"form-group"},c.a.createElement("button",{className:"btn btn-danger",onClick:function(){return t.logout()}},"Logout from Faucet"))):c.a.createElement("div",null,c.a.createElement("div",{className:"form-group"},c.a.createElement("label",{htmlFor:"accountId"},"Create a new account"),c.a.createElement("div",{className:"input-group"},c.a.createElement("div",{className:"input-group-prepend"},c.a.createElement("div",{className:"input-group-text"},"@")),c.a.createElement("input",{placeholder:"bob",id:"accountId",className:this.newAccountClass(),value:this.state.newAccountId,onChange:function(e){return t.handleChange("newAccountId",e.target.value)},disabled:this.state.creating}),c.a.createElement("div",{className:"input-group-append"},c.a.createElement("div",{className:"input-group-text"},this._accountSuffix)))),this.state.newAccountExists&&c.a.createElement("div",{className:"alert alert-warning",role:"alert"},"Account ",'"'+this.state.newAccountId+this._accountSuffix+'"'," already exists!"),c.a.createElement("div",{className:"form-group"},c.a.createElement("button",{className:"btn btn-primary",disabled:this.state.creating||this.state.accountLoading||this.state.newAccountExists||!this.isValidAccount(this.state.newAccountId),onClick:function(){return t.createAccount()}},(this.state.creating||this.state.accountLoading)&&c.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"})," Create Account ",this.isValidAccount(this.state.newAccountId)?'"'+this.state.newAccountId+this._accountSuffix+'"':"")),this.state.creating&&c.a.createElement("div",null,this.state.computingProofOfWork?c.a.createElement("div",null,"Computing Proof of Work. Done ",this.state.proofOfWorkSalt," operations.",c.a.createElement("div",{className:"progress"},c.a.createElement("div",{className:"progress-bar",role:"progressbar",style:{width:this.state.proofOfWorkProgress+"%"},"aria-valuenow":this.state.proofOfWorkProgress,"aria-valuemin":"0","aria-valuemax":"100"},this.state.proofOfWorkDifficulty," out of ",this._minDifficulty))):c.a.createElement("div",null,"Proof of Work is Done! Creating account ",'"'+this.state.newAccountId+this._accountSuffix+'"'))):c.a.createElement("div",null,"Connecting... ",c.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("h1",null,"NEAR Proof of Work Faucet"),"There were ",c.a.createElement("span",{className:"font-weight-bold"},this.state.numCreatedAccounts," accounts")," created using this faucet."),c.a.createElement("hr",null),e)}}]),e}(c.a.Component);o.a.render(c.a.createElement(_,null),document.getElementById("root"))}},[[130,1,2]]]);
//# sourceMappingURL=main.dcc3fd97.chunk.js.map